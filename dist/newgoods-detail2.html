<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="Generator" content="mizanwang.com "/>
    <meta charset="UTF-8">
    <meta http-equiv="refresh" content="600">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"/>
    <link rel="stylesheet" href="css/main.css?v=14"/>
    <link rel="stylesheet" href="css/swiper.min.css?v=7"/>
    <title>Jack Rogers 女士民族风坡跟鞋</title>
    <meta name="Keywords" content="Jack Rogers 女士民族风坡跟鞋"/>
    <meta name="Description" content="跟高约4.5厘米~"/>
    <script type="text/javascript">
        (function (e, a) {
            function f() {
                return parseFloat(e.getComputedStyle(a.documentElement, null)["font-size"])
            }

            function g() {
                if (d) {
                    var b = a.documentElement.offsetWidth;
                    if (d != b) {
                        var c = a.createElement("style");
                        c.innerHTML = "@media only screen and (width: " + b + "px) {html{font-size: " + 200 / 750 * b + "px !important;}}";
                        a.getElementsByTagName("head")[0].appendChild(c);
                        e.removeEventListener("orientationchange", orientationchange)
                    }
                } else d = a.documentElement.offsetWidth, a.documentElement.style.fontSize = 200 / 750 * d + "px", b = f(),
                        c = 200 / 750 * d, b !== c && (b > c + 1 || b < c - 1) && (a.documentElement.style.fontSize = "200px", a.documentElement.style.fontSize = 200 / f() * c + "px")
            }

            var d;
            g();
            0 > e.navigator.userAgent.indexOf("iPhone") && e.addEventListener("orientationchange", function () {
                setTimeout(function () {
                    g()
                }, 300)
            })
        })(window, document);
    </script>
</head>
<body style="font-size: 20px">
<div class="page" >
    <div class="content">
        <div class="downloadApp">
            <div class="downloadLeft">
                <img src="../dist/images/download.png" alt="">
                <div class="colflex">
                    <div class="title">海外购APP</div>
                    <div class="subtitle">有态度的海购分享社区</div>
                </div>
            </div>
            <a class="btn" href="http://a.app.qq.com/o/simple.jsp?pkgname=com.mizanwang.app">立即下载</a>
        </div>
        <div id="goods-detail" class="hasToolbar">
            <div id="goods_news">
                <div class="mm-upthedetailimg">
                    <div class="swiper-container detailPic-swiper">
                        <div class="swiper-wrapper">
                            <!--细节图-->
                        </div>
                        <div class="detailPic-swiper-index">0/0</div>
                    </div>
                    <div class="detail-images swiper-container center">
                        <ul class="swiper-wrapper">
                            <!--类型图-->
                        </ul>
                    </div>
                </div>
                <div class="mm-hastest" style="display: none">
                    <span>蜜赞严选，团队亲测，每月质检</span>
                    <span class="mm-arrow-right"></span>
                </div>

                <div class="detail-name container bd0">
                    <div class="name-title deepergray"><span id="discount" style="color: #ff0101;"></span><span id="nametitle"></span></div>
                    <p class="name-price"><span id="nameprice" class=" colorred"></span> <span class="mm-freetax" style="display: none">包邮包税</span></p>
                    <p class="grayfont name-referprice" style="display: none"><span id="form_refer">国内参考价：</span><span class="line-throungh" id="namereferprice"></span></p>
                    <div class="mm-tag grayfont">
                    </div>
                </div>
                <div class="mm-fromto grayfont"></div>
            </div>
            <!--一次加载-->
            <div id="onecTime">

            </div>

            <div id="Adivce-carriage" class="adivce-carriage" style="display: none;">
                <div class="mm-advice-title">
                    <p class="mm-advice-hrline"></p>
                    <span>商品推荐</span>
                </div>
                <div class="mm-adivce-carriage" id="flag" style="position: relative">
                    <style type="text/css">
                        .infinite-scroll-preloader {
                            margin-top:-20px;
                        }
                    </style>
                    <div class="infinite-scroll infinite-scroll-bottom" data-distance="50">
                        <div class="list-block">
                            <div class="list-container">

                            </div>
                        </div>
                    </div>

                </div>
            </div>

            <div class="detail-buy rowflex before-scale">
                <a class="buy-btn btn-scar" href="#">
                    <span class="buytips buytips-up">成功加入购物车</span>
                    <span class="tag-num" style="display:none;"></span>
                    购物车
                </a>
                <a class="buy-btn btn-shoppingCart">加入购物车</a>
                <a class="buy-btn btn-collect" toggle-class="active" href="#">收藏</a>

            </div>
        </div>
    </div>
</div>


<div id="buyPageInner">
    <div class="buyPage-mark"></div>
    <div class="colflex">
        <div class="flextop">
            <div class="goods-messages rowflex">
                <span class="btn-grayBar"></span>
                <img id="goods_buy_small_image" src="images/demo01.png" alt="Tommy Hilfiger 经典款男士T恤 多色">

                <div class="messages-wrap">
                    <p class="f18" style="margin-bottom: 15px;margin-top: 10px;">¥ <span id="promote_price">0</span><span class="grayfont line-throungh">¥<span id="market_price">0</span></span></p>
                    <p class="f13 grayfont" style="margin-bottom: 15px;">重量<span id="mall_weight">0.0</span>kg&nbsp;&nbsp;&nbsp;&nbsp;运费¥<span id="transit_fee"></span>0</p>
                    <p style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">已选<span id="had_selected_attr_values" ></span></p>
                </div>
            </div>
        </div>
        <div class="flexcenter">
            <div class="goods-tips">
                <span>小蜜提示：</span>
                以下信息均由海外官网提供，仅供参考。
            </div>
            <div class="goods-selection">
                <div id="add_attributeBtn"></div>

                <div class="selection-items">
                    <div class="selection-title">购买数量</div>
                    <ul class="selection-num">
                        <li class="num-subtract">-</li>
                        <li class="num-bar"></li>
                        <li class="number">0</li>
                        <li class="num-bar"></li>
                        <li class="num-add">+</li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="flexbottom">
            <div class="goods-selection">
                <div class="selection-items">
                    <div class="selection-title">目前有货</div>
                    <a class="items-btnConfirm" href="#">加入购物车</a>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="js/zepto.min.js"></script>
<script src="js/swiper.min.js"></script>
<script src="js/ponto.js?v=4"></script>
<script>
    $(document).ready(function() {
        function getQueryString(name) {
            var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
            var r = window.location.search.substr(1).match(reg);
            if (r != null) return unescape(r[2]); return null;
        }
        var Val_id = getQueryString("id");//12
        $.ajax({
            url: "**",
            type: "post",
            dataType: 'JSONP',
            data:{
                intertype:"100",
                id:Val_id,
                deviceid:"86001"
            },
            success: function(data){
                console.log(data);
            }
        });

        /*一次性加载的数据*/
        var goods={
            "goods_id": "5040",
            "name": "日本 BROS 男士舒适平角内裤",
            "is_on_sale": "1",
            "one_detail_p": "<p>  \t材质：聚酯95%，聚氨酯5%  </p>  <p>  \t前档立体剪裁，材质亲肤，整体穿着非常舒适，透气吸汗快干  </p>  <p align=\"center\">  \t<img src=\"http://115.29.51.240:82//images/upload/image/20160731/20160731213949_53293.png\" alt=\"\" />   </p>",
            "brand_logo": "http://115.29.51.240:84/data/brandlogo/",
            "brand_desc": "<p>BROS，日本内衣巨头wacoal（华歌尔）旗下的男士内裤品牌，有25年历史，整体做工优秀，设计带有浓浓的日系风格，简约，有家居味，又不失性感。适合成熟，追求品质的男士。</p>",
            "is_mizan_selected": 0,
            "is_tax_package": 0,
            "lowest_goods_info_id": "72704",
            "goods_child_info": [
                {
                    "goods_info_id": "72703",
                    "buy_small_img": "http://115.29.51.240:84//goods_images/41V952Q7iEL._AA300_.jpg",
                    "target_promote_price": "108",
                    "target_market_price": "134",
                    "target_discount": "8",
                    "mall_weight": "0.12",
                    "transit_price": "40.00",
                    "gallery_list": [
                        {
                            "thumb_url": "http://115.29.51.240:84//goods_images/41V952Q7iEL._SL750_.jpg",
                            "thumb_desc": "Bl",
                            "is_home": 1
                        },
                        {
                            "thumb_url": "http://115.29.51.240:84//goods_images/41ookfXi6vL._SL750_.jpg",
                            "thumb_desc": "Bl",
                            "is_home": 0
                        }, {
                            "thumb_url": "http://115.29.51.240:84//goods_images/41ookfXi6vL._SL750_.jpg",
                            "thumb_desc": "Bl",
                            "is_home": 0
                        }
                    ]
                },
                {
                    "goods_info_id": "72704",
                    "buy_small_img": "http://115.29.51.240:84//goods_images/51Hcpe7-%2ByL._AA300_.jpg",
                    "target_promote_price": "107",
                    "target_market_price": "134",
                    "target_discount": "8",
                    "mall_weight": "0.07",
                    "transit_price": "40.00",
                    "gallery_list": [
                        {
                            "thumb_url": "http://115.29.51.240:84//goods_images/51Hcpe7-%2ByL._SL750_.jpg",
                            "thumb_desc": "BU",
                            "is_home": 1
                        },
                        {
                            "thumb_url": "http://115.29.51.240:84//goods_images/51cZLrA9UiL._SL750_.jpg",
                            "thumb_desc": "BU",
                            "is_home": 0
                        },
                        {
                            "thumb_url": "http://115.29.51.240:84//goods_images/41RYKjj%2BBqL._SL750_.jpg",
                            "thumb_desc": "BU",
                            "is_home": 0
                        }
                    ]
                }
            ],
            "goods_source_list": [
                {
                    "icon": "http://115.29.51.240:84/h5icon/zhiyou.png",
                    "name": "日本直发直邮"
                },
                {
                    "icon": "http://115.29.51.240:84/h5icon/gongzuorids.png",
                    "name": "15-20工作日到手"
                },
                {
                    "icon": "http://115.29.51.240:84/h5icon/guangw.png",
                    "name": "直采"
                }
            ],
            "goods_service_commitment": [
                {
                    "icon": "http://115.29.51.240:84/h5icon/qingguan.png",
                    "name": "正规清关\\n每单必税"
                },
                {
                    "icon": "http://115.29.51.240:84/h5icon/yanxuan.png",
                    "name": "蜜赞严选\\n保税发货"
                },
                {
                    "icon": "http://115.29.51.240:84/h5icon/zhengpin.png",
                    "name": "正品保证\\n官网直采"
                }
            ]
        };
        coloursgoods(goods);
        addOnce(goods);
        var chooseIDinfo;

        function coloursgoods(goodsNew){
            var html = '';
            var lowest;
            var lowest_index;
            lowest = eval(goodsNew.lowest_goods_info_id);
            if(lowest>0){
                //有goods_child_info
                for (var i =0;i<goodsNew.goods_child_info.length;i++){
                    if(eval(goodsNew.goods_child_info[i].goods_info_id) == lowest){
                        for(var u =0;u<goodsNew.goods_child_info[i].gallery_list.length;u++){
                            html +='<div class=swiper-slide><a href="#"><img src="'+goodsNew.goods_child_info[i].gallery_list[u].thumb_url+'" alt="'+goodsNew.goods_child_info[i].gallery_list[u].thumb_desc+'"></a></div>'
                        }
                        lowest_index = i;
                    }
                }
                $(".detailPic-swiper .swiper-wrapper").append(html);
                var typehtml = ''; //缩略图
                if(goodsNew.goods_child_info >10){
                    $(".detail-images ").removeClass("center");
                }
                for(var i =0;i<goodsNew.goods_child_info.length;i++){
                    typehtml += '<li class="swiper-slide" data-type="'+[i]+'" data-goodinfoid="'+goodsNew.goods_child_info[i].goods_info_id+'"><img src="'+goodsNew.goods_child_info[i].buy_small_img+'" alt=""></li>';
                }
                $(".detail-images .swiper-wrapper").append(typehtml);
                $(".detail-images .swiper-wrapper li").eq(lowest_index).addClass("pink-border");
                //内容

                $("#nametitle").html(goodsNew.name);
                $("#nameprice").html('￥'+goodsNew.goods_child_info[lowest_index].target_promote_price);
                if(goodsNew.goods_child_info[lowest_index].target_market_price){
                    $(".name-referprice").show();
                    $("#namereferprice").html('￥'+goodsNew.goods_child_info[lowest_index].target_market_price);
                }
                if(goodsNew.goods_child_info[lowest_index].target_discount){
                    $("#discount").html(goodsNew.goods_child_info[lowest_index].target_discount+'折');
                }
                if(goodsNew.goods_source_list){
                    var tag1html = '';
                    for (var i =0;i<goodsNew.goods_source_list.length;i++){
                        tag1html +='<span class="g" style="background: url(&quot;'+goodsNew.goods_source_list[i].icon+'&quot;) no-repeat;background-size: 14px 14px;">'+goodsNew.goods_source_list[i].name+'</span>';
                    }
                    $(".mm-tag").append(tag1html);
                }
                var CliChooseType = '';
                $(".detail-images ul li").each(function(index){
                    $(this).click(function(){
                        $(".detail-images ul li").removeClass("pink-border");
                        $(this).addClass("pink-border");
                        var goodinfoid = $(this).data("goodinfoid");
                        console.log(goodinfoid);
                        CliChooseType = index;
                        chooseIDinfo = eval($(this).data("goodinfoid"));
                        console.log("点击的是哪个款式："+index+"infoid:"+$(this).data("goodinfoid"));
                        var piclenght = goodsNew.goods_child_info[index].gallery_list.length;
                        var html ='';
                        for(var i=0;i< piclenght;i++){
                            html += '<div class="swiper-slide"><a href="#"><img src="'+goodsNew.goods_child_info[index].gallery_list[i].thumb_url+'" alt=""></a></div>';
                        }
                        $(".detailPic-swiper .swiper-wrapper").empty().append(html);
                        $('.detailPic-swiper').each(function() {
                            var $this = $(this);
                            var $pager = $this.find('.detailPic-swiper-index');
                            $(".detailPic-swiper .swiper-wrapper .swiper-slide").size();
                            new Swiper($this, {
                                loop: true,
                                autoplay: 5000,
                                pagination: $this.find('.swiper-pagination'),
                                onSlideChangeEnd: function(swiper) {
                                    $pager.html((parseInt(swiper.slides[swiper.activeIndex]
                                                    .getAttribute('data-swiper-slide-index')) + 1) +
                                            '/' + ( $(".detailPic-swiper .swiper-wrapper .swiper-slide").size()- 2));
                                }
                            });
                        });

                        $("#nameprice").html('￥'+goodsNew.goods_child_info[index].target_promote_price);
                        if(goodsNew.goods_child_info[index].target_discount){
                            $("#discount").html(goodsNew.goods_child_info[index].target_discount+'折');
                        }
                        if(goodsNew.goods_child_info[index].target_market_price){
                            $(".name-referprice").show();
                            $("#namereferprice").html('￥'+goodsNew.goods_child_info[index].target_market_price);
                        }

                    });
                });
            }else{
                $(".detail-images ").hide();
                //没有goods_child_info
                if(goodsNew.gallery_list){
                    for (var i =0;i<goodsNew.gallery_list.length;i++){
                        html +='<div class=swiper-slide><a href="#"><img src="'+goodsNew.gallery_list[i].thumb_url+'" alt="'+goodsNew.gallery_list[i].thumb_desc+'"></a></div>'
                    }
                    $(".detailPic-swiper .swiper-wrapper").append(html);
                }

                if(goodsNew.target_discount){
                    $("#discount").html(goodsNew.target_discount+'折');
                }
                $("#nametitle").html(goodsNew.name);

                $("#nameprice").html('￥'+goodsNew.target_promote_price);
                if(goodsNew.target_market_price){
                    $(".name-referprice").show();
                    $("#namereferprice").html('￥'+goodsNew.target_market_price);
                }
                if(goodsNew.goods_source_list){
                    var tag1html = '';
                    for (var i =0;i<goodsNew.goods_source_list.length;i++){
                        tag1html +='<span class="g" style="background: url(&quot;'+goodsNew.goods_source_list[i].icon+'&quot;) no-repeat;background-size: 14px 14px;">'+goodsNew.goods_source_list[i].name+'</span>';
                    }
                    $(".mm-tag").append(tag1html);
                }
            }
            $('.detailPic-swiper').each(function() {
                var $this = $(this);
                var $pager = $this.find('.detailPic-swiper-index');
                $(".detailPic-swiper .swiper-wrapper .swiper-slide").size();
                new Swiper($this, {
                    loop: true,
                    autoplay: 5000,
                    pagination: $this.find('.swiper-pagination'),
                    onSlideChangeEnd: function(swiper) {
                        $pager.html((parseInt(swiper.slides[swiper.activeIndex]
                                        .getAttribute('data-swiper-slide-index')) + 1) +
                                '/' + ( $(".detailPic-swiper .swiper-wrapper .swiper-slide").size()- 2));
                    }
                });
            });//滑动
        }
        function addOnce(obj){
            console.log("add");
            $("title").html(obj.name);
            var html = '';
            if(obj.one_p1){
                html+='<div class="pointComment container bd0 mbottom"><div class="mizan-points"><div class="mm-commen-title"><p class="mm-hrline"></p><span>'+obj.one_p1+'</span></div><p class="deepgray">'+obj.one_p2+'</p></div></div>';
            }else {
            }
            if(obj.one_detail_p){
                html +='<div class="goods-detail container bd0 mbottom"><div class=mm-commen-title><p class=mm-hrline></p><span>商品详情</span></div><div class="goods-detail-info deepgray"><div style="text-align:center;">';
                html +=obj.one_detail_p;
                html +='</div></div></div>';
            }else{
                html +='';
            }
            if(obj.brand_desc){
                html +='<div class="goods-detail container bd0 mbottom"><div class=goods-detail-info>';
                html +='<div style="text-align: center;"><img src="'+obj.brand_logo+'" style="height: 60px;"></div><div class="deepgray">'+obj.brand_desc+'</div>';
                html+='</div></div></div>';
            }
            if(obj.is_mizan_selected == 1){
                $(".mm-hastest").show();
            }else {
                $(".mm-hastest").hide();
            }
            if(obj.is_tax_package == 1){
                $(".mm-freetax").show();
            }else {
                $(".mm-freetax").hide();
            }
            if(obj.goods_service_commitment){
                html +='<div class="goods-detail container bd0 mbottom"><div class=mm-commen-title><p class=mm-hrline></p><span>服务承诺</span></div><div class=goods-detail-info>';
                for (var i =0;i<obj.goods_service_commitment.length;i++){
                    html +='<div class="promit promit1" style="background: url(&quot;'+obj.goods_service_commitment[i].icon+'&quot;) no-repeat top center;background-size: 40px 40px;"><p>'+obj.goods_service_commitment[i].name+'</p></div>';
                }
                html+='</div></div>';
            }else{
                html +='';
            }
            if(obj.one_flow_img||obj.one_beforebuy){
                html +='<div class="detail-process container bd0 mbottom">';
                if(obj.one_flow_img){
                    html +='<div class=mm-commen-title><p class=mm-hrline></p><span>物流流程</span></div><img src="'+obj.one_flow_img+'" class=mbottom>';
                }
                if(obj.one_beforebuy){
                    html +='<div class=mm-commen-title><p class=mm-hrline></p><span>买前须知</span></div><ol class=hide>';
                    for (var i =0;i<obj.one_beforebuy.length;i++){
                        html+='<li>'+obj.one_beforebuy[i]+'</li>';
                    }
                    html +='</ol><a class=detail-process-more href="#">阅读全文</a>';
                }
                html +='</div>';
            }
            $('#onecTime').append(html);

            /*显示隐藏*/
            $('.detail-process-more').click(function () {
                var ol = $('.detail-process ol'),
                        arrow = $('.detail-process .detail-process-more'),
                        height = 0;
                if (ol.hasClass('hide')) {
                    ol.children().each(function () {
                        console.log($(this).height());
                        height += $(this).height();
                    });
                    ol.removeClass('hide').css('height', height);
                    arrow.addClass('up');
                } else {
                    ol.addClass('hide').removeAttr('style');
                    arrow.removeClass('up');
                }
                return false;
            });

            var lowest;
            var btncartshop = $('.btn-shoppingCart');
            lowest = eval(obj.lowest_goods_info_id);
            if(obj.is_on_sale == 1){
                btncartshop.click(function () {
                    //获取token后
                    if(lowest>0){
                        console.log("进入购物车");
                        Ponto.invoke(
                                "Messaging",
                                "refreshable",
                                {isfresh:false},
                                null,
                                null);
                        var goodsnum = parseInt($('.number').text()) + 1;
                        detail.hide();
                        $('.number').text(goodsnum);
                        buyPage.show();
                        /*$.ajax({
                            type: "POST",
                            url: "",
                            data:{"id":""},
                            success: function(data){
                                alert(data);
                            }
                        });*/
                        var goodsattr = [
                            {
                                "attr_id": "3107",
                                "attr_name": "Size",
                                "attr_value_info": [
                                    {
                                        "attr_value": "L码",
                                        "goods_info_list": [
                                            {
                                                "goods_info_id": "72702",
                                                "buy_small_img": "http://115.29.51.240:84//goods_images/51Hcpe7-%2ByL._AA300_.jpg",
                                                "promote_price": "108",
                                                "market_price": "134",
                                                "transit_fee": "40.00",
                                                "is_selected": 0
                                            },
                                            {
                                                "goods_info_id": "72703",
                                                "buy_small_img": "http://115.29.51.240:84//goods_images/41V952Q7iEL._AA300_.jpg",
                                                "promote_price": "108",
                                                "market_price": "134",
                                                "transit_fee": "40.00",
                                                "is_selected": 0
                                            }
                                        ]
                                    },
                                    {
                                        "attr_value": "M码",
                                        "goods_info_list": [
                                            {
                                                "goods_info_id": "72704",
                                                "buy_small_img": "http://115.29.51.240:84//goods_images/51Hcpe7-%2ByL._AA300_.jpg",
                                                "promote_price": "107",
                                                "market_price": "134",
                                                "transit_fee": "40.00",
                                                "is_selected": 1
                                            }
                                        ]
                                    }
                                ]
                            },
                            {
                                "attr_id": "3108",
                                "attr_name": "Color",
                                "attr_value_info": [
                                    {
                                        "attr_value": "蓝色",
                                        "goods_info_list": [
                                            {
                                                "goods_info_id": "72702",
                                                "buy_small_img": "http://115.29.51.240:84//goods_images/51Hcpe7-%2ByL._AA300_.jpg",
                                                "promote_price": "108",
                                                "market_price": "134",
                                                "transit_fee": "40.00",
                                                "is_selected": 0
                                            },
                                            {
                                                "goods_info_id": "72704",
                                                "buy_small_img": "http://115.29.51.240:84//goods_images/51Hcpe7-%2ByL._AA300_.jpg",
                                                "promote_price": "107",
                                                "market_price": "134",
                                                "transit_fee": "40.00",
                                                "is_selected": 1
                                            }
                                        ]
                                    },
                                    {
                                        "attr_value": "黑色",
                                        "goods_info_list": [
                                            {
                                                "goods_info_id": "72703",
                                                "buy_small_img": "http://115.29.51.240:84//goods_images/41V952Q7iEL._AA300_.jpg",
                                                "promote_price": "108",
                                                "market_price": "134",
                                                "transit_fee": "40.00",
                                                "is_selected": 0
                                            }
                                        ]
                                    }
                                ]
                            }
                        ];
                        closureselect(goodsattr);
                        function closureselect(obj){
                            console.log("slideup");
                            Ponto.invoke(
                                    "Messaging",
                                    "refreshable",
                                    {isfresh:false},
                                    null,
                                    null);
                            //alert('31')
                            var goodsnum = parseInt($('.number').text()) + 1;
                            detail.hide();
                            $('.number').text(goodsnum);
                            buyPage.show();
                            for(var n=0;n<obj.length;n++){
                                var attributehtml = '<div class=selection-items><div class=selection-title>'+obj[n].attr_name+':</div><ul class="selection-list" data-attrgroup="'+n+'" id="btn_attribute'+n+'">';
                                for(var i =0;i<obj[n].attr_value_info.length;i++){
                                    var allowid = [];
                                    for(var m =0;m<obj[n].attr_value_info[i].goods_info_list.length;m++){
                                        allowid.push(obj[n].attr_value_info[i].goods_info_list[m].goods_info_id)
                                    }
                                    attributehtml +='<li class="selection-valid" data-allowid="'+allowid+'" data-xuhao="'+i+'">'+obj[n].attr_value_info[i].attr_value+'</li>';
                                }
                                attributehtml +='</ul></div>';
                                $("#add_attributeBtn").append(attributehtml);
                                var timearray = new Object(); //临时数组
                                $("#btn_attribute"+n+" li").each(function(a){
                                    $(this).unbind("click");
                                    $(this).bind("click",function(){

                                        $(this).parent().children("li").removeClass("selection-active");
                                        var groupindex=$(this).parent().data("attrgroup");
                                        $(this).addClass("selection-active");

                                        var allowdata =$(this).data("allowid");
                                        var dataStrArr;
                                        var dataIntArr=[];
                                        if (typeof(allowdata) == "string")
                                        {
                                            dataStrArr=allowdata.split(",");
                                            dataStrArr.forEach(function(data){
                                                dataIntArr.push(+data);
                                            });
                                        }else
                                        {
                                            dataStrArr =Number(allowdata);
                                            dataIntArr.push(+dataStrArr);
                                        }

                                        console.log("数组"+dataIntArr);

                                        console.log("click:"+a+"parent"+groupindex+"dataIntArr"+dataIntArr);

                                        timearray.infoid = dataIntArr;
                                        timearray.value = obj[groupindex].attr_value_info[a].goods_info_list;
                                        var hadselect=[];
                                        for(var i =0;i<obj.length;i++){
                                            if(i == groupindex){

                                            }else {
                                                for(var l = 0;l<$("#btn_attribute"+i+" li").size();l++){
                                                    if($("#btn_attribute"+i+" li").eq(l).hasClass("selection-active")){
                                                        console.log("其他的选中的是"+l);
                                                        hadselect =$("#btn_attribute"+i+" li").eq(l).data("allowid");
                                                        thesame(timearray,hadselect);
                                                        function thesame(timearray,hadselect){
                                                            var a;
                                                            var g=[];
                                                            if (typeof(hadselect) == "string")
                                                            {
                                                                a=hadselect.split(",");
                                                                a.forEach(function(data){
                                                                    g.push(+data);
                                                                });
                                                            }else
                                                            {
                                                                a =Number(hadselect);
                                                                g.push(+hadselect);
                                                            }
                                                            for(var s = 0;s < g.length;s++){
                                                                console.log(g.length);
                                                                for(var i =0; i<timearray.infoid.length ;i++){
                                                                    if(g[s] == timearray.infoid[i]){
                                                                        $("#promote_price").html(timearray.value[i].promote_price);
                                                                         $("#market_price").html(timearray.value[i].market_price);
                                                                         $("#mall_weight").html(timearray.value[i].mall_weight);
                                                                         $("#transit_fee").html(timearray.value[i].transit_fee);
                                                                         $("#goods_buy_small_image").attr("src", timearray.value[i].buy_small_img);
                                                                    }
                                                                }
                                                            }
                                                        }

                                                    }else{
                                                        var invalidindex ;
                                                        for(var r = 0;r < dataIntArr.length;r++){  //allow的数
                                                            for(var s = 0;s < obj[i].attr_value_info.length;s++){ //第二级的里的infolist是否存在同样的id 没有就变灰
                                                                console.log(dataIntArr[r]);
                                                                for(var p = 0;p < obj[i].attr_value_info[s].goods_info_list.length;p++){
                                                                    var obj_info_id = eval(obj[i].attr_value_info[s].goods_info_list[p].goods_info_id);
                                                                    if( dataIntArr[r] == obj_info_id ){
                                                                        invalidindex = s;
                                                                    }else{
                                                                        $("#btn_attribute"+i+" li").eq(s).addClass("selection-invalid");
                                                                    }
                                                                    $("#btn_attribute"+i+" li").eq(invalidindex).removeClass("selection-invalid"); //如果id相同
                                                                }
                                                            }
                                                        }
                                                        $("#promote_price").html(timearray.value[0].promote_price);
                                                        $("#market_price").html(timearray.value[0].market_price);
                                                        $("#mall_weight").html(timearray.value[0].mall_weight);
                                                        $("#transit_fee").html(timearray.value[0].transit_fee);
                                                        $("#goods_buy_small_image").attr("src", timearray.value[0].buy_small_img);
                                                    }
                                                }
                                            }
                                        }
                                    });
                                });

                            }

                        }
                    }else{
                        //直接添加进购物车
                        var goodsnum = parseInt($("#goods_number").val()) + 1;
                        //alert(goodsnum);
                        add2Shopcar(goodsnum);
                        //alert(goodsnum);
                        $("#goods_number").val(goodsnum);
                    }
                });
            }else { //已下架
                btncartshop.css({'background':"#ccc",'border': '1px solid #c4c5c6'});
                btncartshop.html("商品已下架")
            }

        }
        /*end*/


        var detailImage = $('.detail-images');
        var detailImageLis = detailImage.find('li'); //缩略图下的li
        var screenWidth = window.innerWidth;
        var detailPicSwiper = $('.detailPic-swiper');
        var ret = 0;


        $('.detailPic-swiper').each(function() {
            var $this = $(this);
            var $pager = $this.find('.detailPic-swiper-index');
            $(".detailPic-swiper .swiper-wrapper .swiper-slide").size();
            new Swiper($this, {
                loop: true,
                autoplay: 5000,
                pagination: $this.find('.swiper-pagination'),
                onSlideChangeEnd: function(swiper) {
                    $pager.html((parseInt(swiper.slides[swiper.activeIndex]
                                    .getAttribute('data-swiper-slide-index')) + 1) +
                            '/' + ( $(".detailPic-swiper .swiper-wrapper .swiper-slide").size()- 2));
                }
            });
        });//滑动

        var detail = $('#goods-detail');
        var buyPage = $('#buyPageInner');
        var detailSelected = $('.detail-selected');
        var btnGrayBar = $('.btn-grayBar');
        var btncartshop = $('.btn-shoppingCart');
        var btncartlist = $('.btn-scar');

        //添加收藏
        var btnCollect = $('.btn-collect');
        btnCollect.click(function () {
            Ponto.invoke(
                    "Messaging",
                    "getToken",
                    {userLogin:true},
                    function (token) {
                        $("#user_login").val(1);
                        $("#token").val(token);
                    },
                    null);
            $.ajax({
                //提交数据的类型 POST GET
                type:"POST",
                //提交的网址
                url:"aaddcoll.html",
                //提交的数据
                data:{device_id:$("#device_id").val(),token:$("#token").val(),goods_id:$("#goods_id").val()},
                //返回数据的格式
                datatype: "json",//"xml", "html", "script", "json", "jsonp", "text".
                //在请求之前调用的函数
                beforeSend:function(){},
                //成功返回之后调用的函数
                success:function(data){
                    //alert('31');
                }   ,
                //调用执行后调用的函数
                complete: function(XMLHttpRequest, textStatus){
                    //alert(XMLHttpRequest.responseText);
                    if(XMLHttpRequest.responseText == 'ok')
                    {
                        //alert("添加收藏成功");
                        Ponto.invoke(
                                "Messaging",
                                "toast",
                                {"title":"添加收藏成功"},
                                null,
                                null);
                    }
                    //alert(textStatus);
                    //HideLoading();
                },
                //调用出错执行的函数
                error: function(){
                    Ponto.invoke(
                            "Messaging",
                            "toast",
                            {"title":'网络断了，请售后再试'},
                            null,
                            null);
                }
            });
        });

        //关闭购物车
        btnGrayBar.click(function () {
            detail.show();
            buyPage.hide();
            Ponto.invoke(
                    "Messaging",
                    "refreshable",
                    {isfresh:true},
                    null,
                    null);
        });
        //加入购物车
        var itembtncfim = $('.items-btnConfirm');
        itembtncfim.click(function () {
            $('.number').text();
            if( $('.number').text() <= 0 )
            {
                Ponto.invoke(
                        "Messaging",
                        "toast",
                        {"title":'请添加购买数量！'},
                        null,
                        null);
                return false;
            }
            if( $("#target_goods_info_id").val() == 0 && $("#is_have_child").val() == 1 )
            {
                Ponto.invoke(
                        "Messaging",
                        "toast",
                        {"title":'请选择商品属性！'},
                        null,
                        null);
                return false;
            }
            add2Shopcar(parseInt($('.number').text()));
        });
        //跳转到购物车
        $('.num-subtract').click(function () {
            var value = parseInt($('.number').text()) - 1;
            if (value <= 0) {
                value = 0;
            }
            $('.number').text(value);
        });
        $('.num-add').click(function () {
            var valuenum = parseInt($('.number').text()) + 1;
            $('.number').text(valuenum);
        });
        var add2Shopcar = (function () {
            var shopcarCounter = 0,
                    $buytips = $('.buytips'),
                    $tagnum = $('.tag-num'),
                    fadeInDownTimer,
                    add = function () {
                        if ($buytips.hasClass('fadeInDown')) {
                            $buytips.removeClass('fadeInDown');
                            clearTimeout(fadeInDownTimer);
                        }
                        $buytips.show().addClass('fadeInDown');
                        fadeInDownTimer = setTimeout(function () {
                            $buytips.hide().removeClass('fadeInDown');
                        }, 1500);
                    },
                    reduce = function () {

                    };

            shopcarCounter = parseInt($tagnum.text());
            return function (count) {
                shopcarCounter += count;
                if (count == 0)  return;

                count = parseInt(count);
                if (shopcarCounter < 0) {
                    shopcarCounter = 0;
                }

                if (count > 0) {
                    $.ajax({
                        //提交数据的类型 POST GET
                        type:"POST",
                        //提交的网址
                        url:"asavecart.html",

                        async:true,
                        //提交的数据
                        data:{device_id:$("#device_id").val(),token:$("#token").val(),goods_id:$("#goods_id").val(),goods_number:count,target_goods_info_id:$("#target_goods_info_id").val(),is_have_child:$("#is_have_child").val()},
                        //返回数据的格式
                        datatype: "json",//"xml", "html", "script", "json", "jsonp", "text".
                        //在请求之前调用的函数
                        beforeSend:function(){},
                        //成功返回之后调用的函数
                        success:function(data){
                            //alert("成功调用了加入购物车");
                            buyPage.hide();

                            detail.show();
                        }   ,
                        //调用执行后调用的函数
                        complete: function(XMLHttpRequest, textStatus){
                            //alert("1oook11");
                            //alert(XMLHttpRequest.responseText);
                            if( XMLHttpRequest.responseText == "ok" )
                            {
                                add();
//					               	  var shopnum = parseInt($tagnum.text());
//					               	  shopnum += count;
                                $tagnum.text(count);
                                $('.tag-num').show();
                                Ponto.invoke(
                                        "Messaging",
                                        "addToCart",
                                        {},
                                        null,
                                        null);
                                if( $('#cart_id').val() > 0 )
                                {
                                    Ponto.invoke(
                                            "Messaging",
                                            "modifCart",
                                            {},
                                            null,
                                            null);
                                }
                            }
                            else if(XMLHttpRequest.responseText == "errlogin" )
                            {
                                Ponto.invoke(
                                        "Messaging",
                                        "login",
                                        {},
                                        null,
                                        null);
//													alert(XMLHttpRequest.responseText);
                            }
                            else if(XMLHttpRequest.responseText == "errgoods" )
                            {
                                Ponto.invoke(
                                        "Messaging",
                                        "toast",
                                        {"title":'商品已经抢光，请联系管理员！'},
                                        null,
                                        null);
                            }
                            else
                            {
                                Ponto.invoke(
                                        "Messaging",
                                        "toast",
                                        {"title": XMLHttpRequest.responseText},
                                        null,
                                        null);
                            }

                            //HideLoading();
                        },
                        //调用出错执行的函数
                        error: function(){
                            //请求出错处理
                            Ponto.invoke(
                                    "Messaging",
                                    "toast",
                                    {"title":'网络断了，请售后再试'},
                                    null,
                                    null);
                        }
                    });
                    Ponto.invoke(
                            "Messaging",
                            "refreshable",
                            {isfresh:true},
                            null,
                            null);
                } else {
                    reduce();
                }
            };
        }());

        /*totop*/
        var $bugpageTop = $('#buyPageInner .colflex .flextop');
        $('#buyPage .colflex .flexcenter').on('scroll', function () {
            if ($(this).scrollTop() > 10) {
                $bugpageTop.addClass('shadow');

            } else {
                $bugpageTop.removeClass('shadow');
            }
        });
    });
</script>
<script>
    function user_login_res(token) {
        //alert('21');
        //alert(token);
        $("#user_login").val(1);
        $("#token").val(token);
    }
</script>
<script type='text/javascript' src='http://g.alicdn.com/msui/sm/0.6.2/js/sm.min.js' charset='utf-8'></script>
<script>
    var objItem = {
        "length":6,
        item:[
            {"img":"images/share-itemsPic.png","name":"士民族风民族民族风风民族风坡跟","price":"$100.00","from":"美国直邮","promo":0,"none":1,"from_icon":"images/us.png"},
            {"img":"images/share-itemsPic.png","name":"士民族风民族民族风风民族风坡跟","price":"$200.00","from":"美国直邮","promo":1,"none":0,"from_icon":"images/us.png"},
            {"img":"images/share-itemsPic.png","name":"士民族风民族民族风风民族风坡跟","price":"$200.00","from":"美国直邮","promo":1,"none":0,"from_icon":"images/us.png"},
            {"img":"images/share-itemsPic.png","name":"士民族风民族民族风风民族风坡跟","price":"$300.00","from":"美国直邮","promo":0,"none":1,"from_icon":"images/us.png"},
            {"img":"images/share-itemsPic.png","name":"士民族风民族民族风风民族风坡跟","price":"$300.00","from":"美国直邮","promo":0,"none":1,"from_icon":"images/us.png"},
            {"img":"images/share-itemsPic.png","name":"士民族风民族民族风风民族风坡跟","price":"$300.00","from":"美国直邮","promo":0,"none":1,"from_icon":"images/us.png"}
        ]
    }

    $(window).scroll(function(){
        var scrollTop = $(this).scrollTop();
        var scrollHeight = $(document).height();
        var windowHeight = $(this).height();
        if(scrollTop + windowHeight == scrollHeight){
            $("#Adivce-carriage").show();
            appendcarriage(objItem);
            /*$.post("#",
             { "id": "1822" },
             function(data){
             alert(data);
             },
             "json");*/
        }
        function appendcarriage(obj){
            var lastIndex = $('.list-container .mm-crriage').length;
            if (lastIndex == obj.length) return;
            addItems(obj);
        }

    });
    function addItems(obj) {
        var html = '';
        for (var i = 0 ; i < obj.item.length; i++) {
            html += '<div class="mm-crriage"><div class="mm-crriage-pic">';
            if(obj.item[i].promo == 1){
                html += '<span class="mm-crriage-promo"></span>';
            }if(obj.item[i].none == 1){
                html += '<span class="mm-crriage-none"></span>';
            }
            html += '<img src="'+obj.item[i].img+'"></div>';

            html += '<p class="mm-crriage-title">'+obj.item[i].name+'</p><p class="mm-crriage-price">'+obj.item[i].price+'</p><p class="mm-crriage-from"><span class="mm-crriage-from-pic" style="background: url(&quot;'+obj.item[i].from_icon+'&quot;) no-repeat top center;background-size: 14px 14px;"></span>'+obj.item[i].from+'</p></div>';
        }
        $('.list-block .list-container').append(html);
    }


</script>
</body>
</html>